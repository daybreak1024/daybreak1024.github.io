# 2016-02-24 iOS 使用主题的思路

### 背景

公司的APP已经上线，突然需要添加主题功能。APP默认拥有一个主题，用户选择不同的项目（项目拥有不同的主题）。优先级为：用户选择、项目默认、APP默认。

### 问题

主题因为颜色不同回合已有的文字、背景造成显示上的冲突。

### 主要思路

主题拥有两种类型需要修改：
1. 文字、背景颜色的修改，即代码修改。
2. 使用不同的图片。

为了保证代码以后不会修改，使用单独的一个管理类修改颜色和将主题需要修改的地方（图片、颜色）都统一命名，通过主题管理者对不同主题进行图片、颜色进行获取使用。保证代码里面不用做任何判断，简单使用。

##### 资源

##### 每个主题对应一个Bundle
每一个主题都有一个对应的Bundle，里面包含了主题的图片、颜色的plist文件。

##### 主题管理者：

我使用了一个主题管理单例类，这个类的主要功能为：

* 提供主题需要使用的颜色：初始化、切换主题的时候将使用对应的主题plist将每个颜色都提取出来，转化为对应的属性。（我们使用的有 主色3、辅色2 以及冲突的颜色和特殊地方的颜色）

* 图片：通过方法转换为"bunldName/imageName"的方式使用图片。

### 使用

##### 主题切换和保存
首先使用枚举表示通的主题(枚举有个对应的字符串数组，代表了对应的bundleName。)

主题类有currentBundleName保留当前主题的bundleName和对应的颜色属性。切换主题就是更改bundleName，并且将颜色属性重新赋值通过plist。

每次切换主题都通过NSUserDefaults将对应的主题名保存起来，用于下次启动使用。

##### 主题默设置
主题枚举有默认主题，初始化时候使用。默认主题不保留到本地，放置项目添加默认主题后冲突。

默认主题的获取是由服务器告知。我们的主题名字进行了统一，服务器返回的主题为bundleName。

##### 总结：

因为开发之初没有对主题考虑，所以添加主题功能的时候会很麻烦，会有很多冲突的颜色、图片。这种做法将处理都归结到了一处，个人觉得很方便（有更好做法的欢迎指教）。

### Tip：

1. 尽量保持每个地方使用的颜色（都是一个级别对应的颜色，比如主色1）在对应主题下一致。

2. 注意色值冲突，最好每个颜色色值冲突后备用颜色只有一个，会减少开发工作量。



本人开发时间不长，很多有错误或者不合理、不简单的地方欢迎指正。
